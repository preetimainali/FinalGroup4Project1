<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Post Form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Test Post Form</h1>
        
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Test Task Posting</h5>
                        <p class="text-muted">This is a simplified version of the post form for testing.</p>
                        
                        <form id="test-post-form">
                            <div class="mb-3">
                                <label for="title" class="form-label">Task Title *</label>
                                <input type="text" class="form-control" id="title" name="title" value="Test Task" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="description" class="form-label">Description *</label>
                                <textarea class="form-control" id="description" name="description" rows="3" required>This is a test task description</textarea>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="payType" class="form-label">Pay Type *</label>
                                    <select class="form-select" id="payType" name="payType" required>
                                        <option value="flat">Flat Rate</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="payAmount" class="form-label">Pay Amount *</label>
                                    <input type="number" class="form-control" id="payAmount" name="payAmount" value="25" required>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="date" class="form-label">Date *</label>
                                    <input type="date" class="form-control" id="date" name="date" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="timeWindow" class="form-label">Time Window *</label>
                                    <select class="form-select" id="timeWindow" name="timeWindow" required>
                                        <option value="Morning (9:00 AM - 12:00 PM)">Morning (9:00 AM - 12:00 PM)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="jobType" class="form-label">Job Type *</label>
                                    <select class="form-select" id="jobType" name="jobType" required>
                                        <option value="local">Local</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="locationType" class="form-label">Location Type *</label>
                                    <select class="form-select" id="locationType" name="locationType" required>
                                        <option value="Campus">Campus</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="locationName" class="form-label">Location Name *</label>
                                <input type="text" class="form-control" id="locationName" name="locationName" value="Student Center" required>
                            </div>
                            
                            <div class="mb-3">
                                <label for="address" class="form-label">Address *</label>
                                <input type="text" class="form-control" id="address" name="address" value="123 Main St" required>
                            </div>
                            
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="bi bi-plus-circle me-2"></i>Post Test Task
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Debug Info</h5>
                        <div id="debug-info">
                            <p><strong>Form Status:</strong> <span id="form-status">Loading...</span></p>
                            <p><strong>Submit Button:</strong> <span id="button-status">Loading...</span></p>
                            <p><strong>User Status:</strong> <span id="user-status">Loading...</span></p>
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-secondary btn-sm" onclick="checkFormStatus()">Check Form Status</button>
                            <button class="btn btn-info btn-sm" onclick="testFormSubmission()">Test Form Submission</button>
                        </div>
                        
                        <div id="test-results" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script src="app.js"></script>
    <script>
        // Set up test user
        const testUser = {
            email: 'test@example.com',
            name: 'Test User',
            phone: '555-0123'
        };
        
        // Initialize data manager and add test user
        if (!dataManager.getUserByEmail(testUser.email)) {
            dataManager.addUser(testUser);
        }
        
        // Set current user
        localStorage.setItem('getitdone_current_user', testUser.email);
        
        // Set today's date
        document.getElementById('date').value = new Date().toISOString().split('T')[0];
        
        // Wait for app to initialize
        setTimeout(() => {
            checkFormStatus();
        }, 1000);
        
        function checkFormStatus() {
            const form = document.getElementById('test-post-form');
            const submitButton = form?.querySelector('button[type="submit"]');
            const currentUser = localStorage.getItem('getitdone_current_user');
            
            document.getElementById('form-status').textContent = form ? 'Found' : 'Not Found';
            document.getElementById('button-status').textContent = submitButton ? 
                (submitButton.disabled ? 'Disabled' : 'Enabled') : 'Not Found';
            document.getElementById('user-status').textContent = currentUser || 'Not Logged In';
            
            console.log('Form status check:');
            console.log('- Form found:', !!form);
            console.log('- Submit button found:', !!submitButton);
            console.log('- Submit button disabled:', submitButton?.disabled);
            console.log('- Current user:', currentUser);
        }
        
        function testFormSubmission() {
            const form = document.getElementById('test-post-form');
            const submitButton = form?.querySelector('button[type="submit"]');
            
            console.log('Testing form submission...');
            console.log('Form:', form);
            console.log('Submit button:', submitButton);
            console.log('Submit button disabled:', submitButton?.disabled);
            
            if (submitButton && !submitButton.disabled) {
                console.log('Manually triggering form submission...');
                form.dispatchEvent(new Event('submit'));
            } else {
                console.log('Cannot submit form - button disabled or not found');
                document.getElementById('test-results').innerHTML = 
                    '<div class="alert alert-warning">Cannot submit form - button disabled or not found</div>';
            }
        }
        
        // Add manual form submission handler
        document.getElementById('test-post-form').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Manual form submission handler triggered!');
            
            const formData = new FormData(this);
            const taskData = {
                title: formData.get('title'),
                description: formData.get('description'),
                tags: ['test'],
                payType: formData.get('payType'),
                payAmount: parseInt(formData.get('payAmount')),
                date: formData.get('date'),
                timeWindow: formData.get('timeWindow'),
                jobType: formData.get('jobType'),
                college: '',
                locationType: formData.get('locationType'),
                locationName: formData.get('locationName'),
                address: formData.get('address'),
                coordinates: null,
                posterName: testUser.name,
                posterEmail: testUser.email
            };
            
            console.log('Manual submission - task data:', taskData);
            
            try {
                const newTask = dataManager.addTask(taskData);
                console.log('Manual submission - task created:', newTask);
                document.getElementById('test-results').innerHTML = 
                    '<div class="alert alert-success">Task posted successfully! ID: ' + newTask.id + '</div>';
            } catch (error) {
                console.error('Manual submission error:', error);
                document.getElementById('test-results').innerHTML = 
                    '<div class="alert alert-danger">Error: ' + error.message + '</div>';
            }
        });
    </script>
</body>
</html>
