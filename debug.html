<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Task Posting</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Debug Task Posting</h1>
        
        <div class="row">
            <div class="col-md-6">
                <h3>Test Data Manager</h3>
                <button class="btn btn-primary mb-3" onclick="testDataManager()">Test Data Manager</button>
                <button class="btn btn-secondary mb-3" onclick="addTestTask()">Add Test Task</button>
                <button class="btn btn-info mb-3" onclick="clearAllTasks()">Clear All Tasks</button>
                <div id="debug-output" class="mt-3"></div>
            </div>
            
            <div class="col-md-6">
                <h3>Current Tasks</h3>
                <button class="btn btn-secondary mb-3" onclick="loadAllTasks()">Load All Tasks</button>
                <div id="tasks-output"></div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h3>Test Form Submission</h3>
                <form id="debug-form">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="debug-title" class="form-label">Title</label>
                                <input type="text" class="form-control" id="debug-title" name="title" value="Debug Test Task" required>
                            </div>
                            <div class="mb-3">
                                <label for="debug-description" class="form-label">Description</label>
                                <textarea class="form-control" id="debug-description" name="description" required>This is a debug test task</textarea>
                            </div>
                            <div class="mb-3">
                                <label for="debug-payType" class="form-label">Pay Type</label>
                                <select class="form-select" id="debug-payType" name="payType" required>
                                    <option value="flat">Flat Rate</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="debug-payAmount" class="form-label">Pay Amount</label>
                                <input type="number" class="form-control" id="debug-payAmount" name="payAmount" value="50" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="debug-date" class="form-label">Date</label>
                                <input type="date" class="form-control" id="debug-date" name="date" required>
                            </div>
                            <div class="mb-3">
                                <label for="debug-timeWindow" class="form-label">Time Window</label>
                                <select class="form-select" id="debug-timeWindow" name="timeWindow" required>
                                    <option value="Morning (9:00 AM - 12:00 PM)">Morning (9:00 AM - 12:00 PM)</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="debug-jobType" class="form-label">Job Type</label>
                                <select class="form-select" id="debug-jobType" name="jobType" required>
                                    <option value="local">Local</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="debug-locationType" class="form-label">Location Type</label>
                                <select class="form-select" id="debug-locationType" name="locationType" required>
                                    <option value="Campus">Campus</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="debug-locationName" class="form-label">Location Name</label>
                        <input type="text" class="form-control" id="debug-locationName" name="locationName" value="Student Center" required>
                    </div>
                    <div class="mb-3">
                        <label for="debug-address" class="form-label">Address</label>
                        <input type="text" class="form-control" id="debug-address" name="address" value="123 Main St" required>
                    </div>
                    <button type="submit" class="btn btn-success">Submit Debug Form</button>
                </form>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        // Set up test user
        const testUser = {
            email: 'debug@example.com',
            name: 'Debug User',
            phone: '555-9999'
        };
        
        // Initialize data manager
        console.log('Initializing debug page...');
        
        // Add test user if not exists
        if (!dataManager.getUserByEmail(testUser.email)) {
            dataManager.addUser(testUser);
            console.log('Added test user');
        }
        
        // Set current user
        localStorage.setItem('getitdone_current_user', testUser.email);
        console.log('Set current user to:', testUser.email);
        
        // Set today's date
        document.getElementById('debug-date').value = new Date().toISOString().split('T')[0];
        
        function testDataManager() {
            const output = document.getElementById('debug-output');
            output.innerHTML = '<h5>Data Manager Test Results:</h5>';
            
            try {
                const allTasks = dataManager.getAllTasks();
                output.innerHTML += `<p>✓ getAllTasks() works - Found ${allTasks.length} tasks</p>`;
                
                const allUsers = dataManager.getAllUsers();
                output.innerHTML += `<p>✓ getAllUsers() works - Found ${allUsers.length} users</p>`;
                
                const currentUser = dataManager.getUserByEmail(testUser.email);
                output.innerHTML += `<p>✓ getUserByEmail() works - Found user: ${currentUser ? currentUser.name : 'Not found'}</p>`;
                
                output.innerHTML += '<p class="text-success">✓ Data Manager is working correctly!</p>';
            } catch (error) {
                output.innerHTML += `<p class="text-danger">✗ Error: ${error.message}</p>`;
            }
        }
        
        function addTestTask() {
            const taskData = {
                title: 'Debug Test Task',
                description: 'This is a test task created for debugging',
                tags: ['debug', 'test'],
                payType: 'flat',
                payAmount: 25,
                date: new Date().toISOString().split('T')[0],
                timeWindow: 'Morning (9:00 AM - 12:00 PM)',
                jobType: 'local',
                college: '',
                locationType: 'Campus',
                locationName: 'Student Center',
                address: '123 Main St',
                coordinates: null,
                posterName: testUser.name,
                posterEmail: testUser.email
            };
            
            try {
                const newTask = dataManager.addTask(taskData);
                console.log('Test task added:', newTask);
                alert('Test task added successfully! ID: ' + newTask.id);
                loadAllTasks();
            } catch (error) {
                console.error('Error adding test task:', error);
                alert('Error adding test task: ' + error.message);
            }
        }
        
        function clearAllTasks() {
            localStorage.removeItem('getitdone_tasks');
            console.log('All tasks cleared');
            alert('All tasks cleared');
            loadAllTasks();
        }
        
        function loadAllTasks() {
            const tasks = dataManager.getAllTasks();
            const container = document.getElementById('tasks-output');
            
            container.innerHTML = '';
            
            if (tasks.length === 0) {
                container.innerHTML = '<p class="text-muted">No tasks found</p>';
                return;
            }
            
            tasks.forEach(task => {
                const div = document.createElement('div');
                div.className = 'card mb-2';
                div.innerHTML = `
                    <div class="card-body">
                        <h6 class="card-title">${task.title}</h6>
                        <p class="card-text">${task.description}</p>
                        <small class="text-muted">
                            $${task.payAmount} • ${task.posterName} • ${task.status} • ID: ${task.id}
                        </small>
                        <div class="mt-2">
                            ${task.tags ? task.tags.map(tag => `<span class="badge bg-secondary me-1">#${tag}</span>`).join('') : ''}
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }
        
        // Handle debug form submission
        document.getElementById('debug-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const taskData = {
                title: formData.get('title'),
                description: formData.get('description'),
                tags: ['debug'],
                payType: formData.get('payType'),
                payAmount: parseInt(formData.get('payAmount')),
                date: formData.get('date'),
                timeWindow: formData.get('timeWindow'),
                jobType: formData.get('jobType'),
                college: '',
                locationType: formData.get('locationType'),
                locationName: formData.get('locationName'),
                address: formData.get('address'),
                coordinates: null,
                posterName: testUser.name,
                posterEmail: testUser.email
            };
            
            console.log('Submitting debug form with data:', taskData);
            
            try {
                const newTask = dataManager.addTask(taskData);
                console.log('Debug task posted successfully:', newTask);
                alert('Debug task posted successfully! ID: ' + newTask.id);
                loadAllTasks();
            } catch (error) {
                console.error('Error posting debug task:', error);
                alert('Error posting debug task: ' + error.message);
            }
        });
        
        // Load tasks on page load
        loadAllTasks();
    </script>
</body>
</html>
