<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Task Posting</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Test Task Posting</h1>
        
        <div class="row">
            <div class="col-md-6">
                <h3>Post a Test Task</h3>
                <form id="test-form">
                    <div class="mb-3">
                        <label for="title" class="form-label">Title</label>
                        <input type="text" class="form-control" id="title" name="title" value="Test Task" required>
                    </div>
                    <div class="mb-3">
                        <label for="description" class="form-label">Description</label>
                        <textarea class="form-control" id="description" name="description" required>This is a test task</textarea>
                    </div>
                    <div class="mb-3">
                        <label for="payType" class="form-label">Pay Type</label>
                        <select class="form-select" id="payType" name="payType" required>
                            <option value="flat">Flat Rate</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="payAmount" class="form-label">Pay Amount</label>
                        <input type="number" class="form-control" id="payAmount" name="payAmount" value="25" required>
                    </div>
                    <div class="mb-3">
                        <label for="date" class="form-label">Date</label>
                        <input type="date" class="form-control" id="date" name="date" required>
                    </div>
                    <div class="mb-3">
                        <label for="timeWindow" class="form-label">Time Window</label>
                        <select class="form-select" id="timeWindow" name="timeWindow" required>
                            <option value="Morning (9:00 AM - 12:00 PM)">Morning (9:00 AM - 12:00 PM)</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="jobType" class="form-label">Job Type</label>
                        <select class="form-select" id="jobType" name="jobType" required>
                            <option value="local">Local</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="locationType" class="form-label">Location Type</label>
                        <select class="form-select" id="locationType" name="locationType" required>
                            <option value="Campus">Campus</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="locationName" class="form-label">Location Name</label>
                        <input type="text" class="form-control" id="locationName" name="locationName" value="Student Center" required>
                    </div>
                    <div class="mb-3">
                        <label for="address" class="form-label">Address</label>
                        <input type="text" class="form-control" id="address" name="address" value="123 Main St" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Post Test Task</button>
                </form>
            </div>
            
            <div class="col-md-6">
                <h3>Current Tasks</h3>
                <button class="btn btn-secondary mb-3" onclick="loadTasks()">Refresh Tasks</button>
                <div id="tasks-list"></div>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script>
        // Set up test user
        const testUser = {
            email: 'test@example.com',
            name: 'Test User',
            phone: '555-0123'
        };
        
        // Add test user to data manager
        if (!dataManager.getUserByEmail(testUser.email)) {
            dataManager.addUser(testUser);
        }
        
        // Set current user
        localStorage.setItem('getitdone_current_user', testUser.email);
        
        // Set today's date
        document.getElementById('date').value = new Date().toISOString().split('T')[0];
        
        // Handle form submission
        document.getElementById('test-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const taskData = {
                title: formData.get('title'),
                description: formData.get('description'),
                tags: ['test'],
                payType: formData.get('payType'),
                payAmount: parseInt(formData.get('payAmount')),
                date: formData.get('date'),
                timeWindow: formData.get('timeWindow'),
                jobType: formData.get('jobType'),
                college: '',
                locationType: formData.get('locationType'),
                locationName: formData.get('locationName'),
                address: formData.get('address'),
                coordinates: null,
                posterName: testUser.name,
                posterEmail: testUser.email
            };
            
            console.log('Posting task:', taskData);
            
            try {
                const newTask = dataManager.addTask(taskData);
                console.log('Task posted successfully:', newTask);
                alert('Task posted successfully! ID: ' + newTask.id);
                loadTasks();
            } catch (error) {
                console.error('Error posting task:', error);
                alert('Error posting task: ' + error.message);
            }
        });
        
        function loadTasks() {
            const tasks = dataManager.getAllTasks();
            const container = document.getElementById('tasks-list');
            
            container.innerHTML = '';
            
            if (tasks.length === 0) {
                container.innerHTML = '<p class="text-muted">No tasks found</p>';
                return;
            }
            
            tasks.forEach(task => {
                const div = document.createElement('div');
                div.className = 'card mb-2';
                div.innerHTML = `
                    <div class="card-body">
                        <h6 class="card-title">${task.title}</h6>
                        <p class="card-text">${task.description}</p>
                        <small class="text-muted">$${task.payAmount} • ${task.posterName} • ${task.status}</small>
                    </div>
                `;
                container.appendChild(div);
            });
        }
        
        // Load tasks on page load
        loadTasks();
    </script>
</body>
</html>
