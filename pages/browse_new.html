<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Browse Tasks - GetItDone</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/styles/styles.css">
</head>
<body>
    <!-- Fiverr-Style Header -->
    <header class="fiverr-header">
        <!-- Top Section -->
        <div class="header-top">
            <div class="container">
                <div class="header-content">
                    <!-- Logo -->
                    <div class="header-logo">
                        <a href="index.html" class="logo-link">
                            <i class="bi bi-check-circle-fill me-2"></i>
                            <span class="logo-text">GetItDone</span>
                        </a>
                    </div>
                    
                    <!-- Mobile Categories Menu Button -->
                    <div class="mobile-categories-btn">
                        <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileCategories" aria-controls="mobileCategories">
                            <i class="bi bi-list"></i>
                        </button>
                    </div>
                    
                    <!-- Search Bar -->
                    <div class="header-search">
                        <div class="search-container">
                            <input type="text" class="search-input" placeholder="What task are you looking for today?" id="header-search-input">
                            <button class="search-button" onclick="performSearch()">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                        <!-- Search Suggestions Dropdown -->
                        <div class="search-suggestions" id="search-suggestions">
                            <div class="suggestion-item" onclick="selectSuggestion('tutoring')">
                                <i class="bi bi-book"></i>
                                <span>Tutoring</span>
                            </div>
                            <div class="suggestion-item" onclick="selectSuggestion('cleaning')">
                                <i class="bi bi-house"></i>
                                <span>House Cleaning</span>
                            </div>
                            <div class="suggestion-item" onclick="selectSuggestion('delivery')">
                                <i class="bi bi-truck"></i>
                                <span>Delivery</span>
                            </div>
                            <div class="suggestion-item" onclick="selectSuggestion('tech help')">
                                <i class="bi bi-laptop"></i>
                                <span>Tech Help</span>
                            </div>
                            <div class="suggestion-item" onclick="selectSuggestion('creative')">
                                <i class="bi bi-palette"></i>
                                <span>Creative Services</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Actions -->
                    <div class="header-actions">
                        <!-- Not Logged In -->
                        <div id="guest-actions">
                            <a href="#" class="action-link" onclick="showLoginModal()">Login</a>
                            <a href="#" class="action-link" onclick="showRegisterModal()">Join</a>
                        </div>
                        
                        <!-- Logged In User -->
                        <div id="user-actions" style="display: none;">
                            <!-- Notifications -->
                            <div class="action-icon position-relative" onclick="showNotifications()">
                                <i class="bi bi-bell"></i>
                                <span class="notification-badge" id="header-notification-badge" style="display: none;">0</span>
                            </div>
                            
                            <!-- Messages -->
                            <div class="action-icon position-relative" onclick="openMessagesModal()">
                                <i class="bi bi-envelope"></i>
                                <span class="notification-badge" id="header-message-badge" style="display: none;">0</span>
                            </div>
                            
                            <!-- Orders/Tasks -->
                            <a href="my-stuff.html" class="action-link">My Tasks</a>
                            <a href="my-stuff.html" class="action-icon mobile-only" title="My Tasks">
                                <i class="bi bi-briefcase"></i>
                            </a>
                            
                            <!-- User Profile -->
                            <div class="user-profile" id="header-user-profile">
                                <div class="profile-avatar-header" onclick="toggleProfileDropdown()">
                                    <span class="profile-initial" id="profile-initial">U</span>
                                    <div class="online-indicator"></div>
                                </div>
                                
                                <!-- Profile Dropdown -->
                                <div class="profile-dropdown" id="profile-dropdown">
                                    <div class="dropdown-header">
                                        <div class="dropdown-user-info">
                                            <div class="dropdown-avatar">
                                                <span class="dropdown-initial" id="dropdown-initial">U</span>
                                            </div>
                                            <div class="dropdown-details">
                                                <div class="dropdown-name" id="dropdown-name">User Name</div>
                                                <div class="dropdown-email" id="dropdown-email">user@email.com</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="dropdown-divider"></div>
                                    <a href="account.html" class="dropdown-item">
                                        <i class="bi bi-person-circle"></i>
                                        <span>My Profile</span>
                                    </a>
                                    <a href="my-stuff.html" class="dropdown-item">
                                        <i class="bi bi-briefcase"></i>
                                        <span>My Tasks</span>
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a href="rules.html" class="dropdown-item">
                                        <i class="bi bi-shield-check"></i>
                                        <span>Rules & Safety</span>
                                    </a>
                                    <a href="about.html" class="dropdown-item">
                                        <i class="bi bi-info-circle"></i>
                                        <span>About</span>
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a href="#" class="dropdown-item" onclick="logout()">
                                        <i class="bi bi-box-arrow-right"></i>
                                        <span>Logout</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <div class="header-bottom">
            <div class="container">
                <div class="bottom-nav">
                    <a href="post.html" class="post-task-btn">
                        <i class="bi bi-plus-circle"></i>
                        <span>Post a Task</span>
                    </a>
                    
                    <div class="category-nav">
                        <div class="category-item">
                            <a href="browse.html?category=academic" class="category-link">Academic Help</a>
                            <div class="category-preview">
                                <div class="preview-header">
                                    <h6>Popular Academic Tasks</h6>
                                </div>
                                <div class="preview-content">
                                    <div class="preview-task">Math tutoring</div>
                                    <div class="preview-task">Essay writing</div>
                                    <div class="preview-task">Research help</div>
                                </div>
                            </div>
                        </div>
                        <div class="category-item">
                            <a href="browse.html?category=household" class="category-link">Household Tasks</a>
                            <div class="category-preview">
                                <div class="preview-header">
                                    <h6>Popular Household Tasks</h6>
                                </div>
                                <div class="preview-content">
                                    <div class="preview-task">House cleaning</div>
                                    <div class="preview-task">Laundry</div>
                                    <div class="preview-task">Organizing</div>
                                </div>
                            </div>
                        </div>
                        <div class="category-item">
                            <a href="browse.html?category=tech" class="category-link">Tech Support</a>
                            <div class="category-preview">
                                <div class="preview-header">
                                    <h6>Popular Tech Tasks</h6>
                                </div>
                                <div class="preview-content">
                                    <div class="preview-task">Computer setup</div>
                                    <div class="preview-task">Software help</div>
                                    <div class="preview-task">Website building</div>
                                </div>
                            </div>
                        </div>
                        <div class="category-item">
                            <a href="browse.html?category=creative" class="category-link">Creative Services</a>
                            <div class="category-preview">
                                <div class="preview-header">
                                    <h6>Popular Creative Tasks</h6>
                                </div>
                                <div class="preview-content">
                                    <div class="preview-task">Graphic design</div>
                                    <div class="preview-task">Photo editing</div>
                                    <div class="preview-task">Video creation</div>
                                </div>
                            </div>
                        </div>
                        <div class="category-item">
                            <a href="browse.html?category=delivery" class="category-link">Delivery & Errands</a>
                            <div class="category-preview">
                                <div class="preview-header">
                                    <h6>Popular Delivery Tasks</h6>
                                </div>
                                <div class="preview-content">
                                    <div class="preview-task">Package pickup</div>
                                    <div class="preview-task">Grocery shopping</div>
                                    <div class="preview-task">Meal delivery</div>
                                </div>
                            </div>
                        </div>
                        <div class="category-item">
                            <a href="browse.html?category=other" class="category-link">Other Services</a>
                            <div class="category-preview">
                                <div class="preview-header">
                                    <h6>Popular Other Tasks</h6>
                                </div>
                                <div class="preview-content">
                                    <div class="preview-task">Pet sitting</div>
                                    <div class="preview-task">Event planning</div>
                                    <div class="preview-task">Consulting</div>
                                </div>
                            </div>
                        </div>
                        <a href="browse.html" class="category-link more">
                            <span>More</span>
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Categories Offcanvas -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileCategories" aria-labelledby="mobileCategoriesLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="mobileCategoriesLabel">Browse Categories</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="d-grid gap-2">
                <a href="post.html" class="btn btn-outline-primary">
                    <i class="bi bi-plus-circle me-2"></i>Post a Task
                </a>
                <hr>
                <a href="browse.html?category=academic" class="btn btn-outline-secondary text-start">
                    Academic Help
                </a>
                <a href="browse.html?category=household" class="btn btn-outline-secondary text-start">
                    Household Tasks
                </a>
                <a href="browse.html?category=tech" class="btn btn-outline-secondary text-start">
                    Tech Support
                </a>
                <a href="browse.html?category=creative" class="btn btn-outline-secondary text-start">
                    Creative Services
                </a>
                <a href="browse.html?category=delivery" class="btn btn-outline-secondary text-start">
                    Delivery & Errands
                </a>
                <a href="browse.html?category=other" class="btn btn-outline-secondary text-start">
                    Other Services
                </a>
                <a href="browse.html" class="btn btn-outline-secondary text-start">
                    View All Tasks
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container py-4">
        <!-- Category Filter Display -->
        <div class="row mb-4">
            <div class="col-12">
                <div id="category-filter-display" class="alert alert-info d-none">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-funnel me-2"></i>
                            <span id="category-filter-text">Showing tasks in category</span>
                        </div>
                        <button type="button" class="btn-close" onclick="clearCategoryFilter()"></button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Filters Sidebar -->
            <div class="col-lg-3 mb-4">
                <div class="filter-panel">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="fw-bold mb-0">Filters</h5>
                        <button class="btn btn-outline-primary btn-sm d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#filtersOffcanvas">
                            <i class="bi bi-funnel"></i>
                        </button>
                    </div>

                    <!-- Mobile Offcanvas -->
                    <div class="offcanvas offcanvas-start d-lg-none" tabindex="-1" id="filtersOffcanvas">
                        <div class="offcanvas-header">
                            <h5 class="offcanvas-title">Filters</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
                        </div>
                        <div class="offcanvas-body">
                            <form id="filter-form-mobile">
                                <!-- Search -->
                                <div class="filter-section">
                                    <label for="search-input-mobile" class="filter-title">Search</label>
                                    <input type="text" class="form-control" id="search-input-mobile" placeholder="Search tasks...">
                                </div>

                                <!-- Tags -->
                                <div class="filter-section">
                                    <label class="filter-title">Tags</label>
                                    <div class="tag-filters" id="tag-filters-mobile">
                                        <!-- Tags will be populated by JavaScript -->
                                    </div>
                                </div>

                                <!-- Status -->
                                <div class="filter-section">
                                    <label class="filter-title">Status</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="open" id="status-open-mobile">
                                        <label class="form-check-label" for="status-open-mobile">
                                            Open Tasks
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="assigned" id="status-assigned-mobile">
                                        <label class="form-check-label" for="status-assigned-mobile">
                                            Assigned Tasks
                                        </label>
                                    </div>
                                </div>

                                <!-- Job Type -->
                                <div class="filter-section">
                                    <label class="filter-title">Job Type</label>
                                    <select class="form-select" id="job-type-mobile">
                                        <option value="">All Types</option>
                                        <option value="one-time">One-time</option>
                                        <option value="recurring">Recurring</option>
                                        <option value="project">Project</option>
                                    </select>
                                </div>

                                <!-- College -->
                                <div class="filter-section">
                                    <label class="filter-title">College</label>
                                    <select class="form-select" id="college-filter-mobile">
                                        <option value="">All Colleges</option>
                                        <option value="MIT">MIT</option>
                                        <option value="Harvard">Harvard</option>
                                        <option value="Stanford">Stanford</option>
                                        <option value="UC Berkeley">UC Berkeley</option>
                                    </select>
                                </div>

                                <!-- Location -->
                                <div class="filter-section">
                                    <label class="filter-title">Location</label>
                                    <input type="text" class="form-control" id="location-filter-mobile" placeholder="Enter location...">
                                </div>

                                <!-- Time -->
                                <div class="filter-section">
                                    <label class="filter-title">Time</label>
                                    <select class="form-select" id="time-filter-mobile">
                                        <option value="">Any Time</option>
                                        <option value="today">Today</option>
                                        <option value="tomorrow">Tomorrow</option>
                                        <option value="this-week">This Week</option>
                                        <option value="this-month">This Month</option>
                                    </select>
                                </div>

                                <!-- Pay Range -->
                                <div class="filter-section">
                                    <label class="filter-title">Pay Range</label>
                                    <div class="row">
                                        <div class="col-6">
                                            <input type="number" class="form-control" id="min-pay-mobile" placeholder="Min $" min="0">
                                        </div>
                                        <div class="col-6">
                                            <input type="number" class="form-control" id="max-pay-mobile" placeholder="Max $" min="0">
                                        </div>
                                    </div>
                                </div>

                                <!-- Deadline -->
                                <div class="filter-section">
                                    <label for="deadline-filter-mobile" class="filter-title">Deadline</label>
                                    <input type="date" class="form-control" id="deadline-filter-mobile">
                                </div>

                                <!-- Minimum Poster Rating -->
                                <div class="filter-section">
                                    <label class="filter-title">Minimum Poster Rating</label>
                                    <select class="form-select" id="min-rating-mobile">
                                        <option value="">Any Rating</option>
                                        <option value="4.5">4.5+ Stars</option>
                                        <option value="4.0">4.0+ Stars</option>
                                        <option value="3.5">3.5+ Stars</option>
                                        <option value="3.0">3.0+ Stars</option>
                                    </select>
                                </div>

                                <!-- Maximum Distance -->
                                <div class="filter-section">
                                    <label class="filter-title">Maximum Distance</label>
                                    <select class="form-select" id="max-distance-mobile">
                                        <option value="">Any Distance</option>
                                        <option value="1">Within 1 mile</option>
                                        <option value="5">Within 5 miles</option>
                                        <option value="10">Within 10 miles</option>
                                        <option value="25">Within 25 miles</option>
                                    </select>
                                </div>

                                <div class="d-grid gap-2 mt-4">
                                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                                    <button type="button" class="btn btn-outline-secondary" onclick="clearFilters('mobile')">Clear All</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Desktop Filters -->
                    <form id="filter-form">
                        <!-- Search -->
                        <div class="filter-section">
                            <label for="search-input" class="filter-title">Search</label>
                            <div class="position-relative">
                                <input type="text" class="form-control" id="search-input" placeholder="Search tasks...">
                                <button type="button" class="btn btn-link position-absolute end-0 top-50 translate-middle-y me-2" id="search-clear" style="display: none;">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Tags -->
                        <div class="filter-section">
                            <label class="filter-title">Tags</label>
                            <div class="tag-filters" id="tag-filters">
                                <!-- Tags will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Status -->
                        <div class="filter-section">
                            <label class="filter-title">Status</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="open" id="status-open">
                                <label class="form-check-label" for="status-open">
                                    Open Tasks
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="assigned" id="status-assigned">
                                <label class="form-check-label" for="status-assigned">
                                    Assigned Tasks
                                </label>
                            </div>
                        </div>

                        <!-- Job Type -->
                        <div class="filter-section">
                            <label class="filter-title">Job Type</label>
                            <select class="form-select" id="job-type">
                                <option value="">All Types</option>
                                <option value="one-time">One-time</option>
                                <option value="recurring">Recurring</option>
                                <option value="project">Project</option>
                            </select>
                        </div>

                        <!-- College -->
                        <div class="filter-section">
                            <label class="filter-title">College</label>
                            <select class="form-select" id="college-filter">
                                <option value="">All Colleges</option>
                                <option value="MIT">MIT</option>
                                <option value="Harvard">Harvard</option>
                                <option value="Stanford">Stanford</option>
                                <option value="UC Berkeley">UC Berkeley</option>
                            </select>
                        </div>

                        <!-- Location -->
                        <div class="filter-section">
                            <label class="filter-title">Location</label>
                            <input type="text" class="form-control" id="location-filter" placeholder="Enter location...">
                        </div>

                        <!-- Time -->
                        <div class="filter-section">
                            <label class="filter-title">Time</label>
                            <select class="form-select" id="time-filter">
                                <option value="">Any Time</option>
                                <option value="today">Today</option>
                                <option value="tomorrow">Tomorrow</option>
                                <option value="this-week">This Week</option>
                                <option value="this-month">This Month</option>
                            </select>
                        </div>

                        <!-- Pay Range -->
                        <div class="filter-section">
                            <label class="filter-title">Pay Range</label>
                            <div class="row">
                                <div class="col-6">
                                    <input type="number" class="form-control" id="min-pay" placeholder="Min $" min="0">
                                </div>
                                <div class="col-6">
                                    <input type="number" class="form-control" id="max-pay" placeholder="Max $" min="0">
                                </div>
                            </div>
                        </div>

                        <!-- Deadline -->
                        <div class="filter-section">
                            <label for="deadline-filter" class="filter-title">Deadline</label>
                            <input type="date" class="form-control" id="deadline-filter">
                        </div>

                        <!-- Minimum Poster Rating -->
                        <div class="filter-section">
                            <label class="filter-title">Minimum Poster Rating</label>
                            <select class="form-select" id="min-rating">
                                <option value="">Any Rating</option>
                                <option value="4.5">4.5+ Stars</option>
                                <option value="4.0">4.0+ Stars</option>
                                <option value="3.5">3.5+ Stars</option>
                                <option value="3.0">3.0+ Stars</option>
                            </select>
                        </div>

                        <!-- Maximum Distance -->
                        <div class="filter-section">
                            <label class="filter-title">Maximum Distance</label>
                            <select class="form-select" id="max-distance">
                                <option value="">Any Distance</option>
                                <option value="1">Within 1 mile</option>
                                <option value="5">Within 5 miles</option>
                                <option value="10">Within 10 miles</option>
                                <option value="25">Within 25 miles</option>
                            </select>
                        </div>

                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary">Apply Filters</button>
                            <button type="button" class="btn btn-outline-secondary" onclick="clearFilters()">Clear All</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Tasks List -->
            <div class="col-lg-9">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="fw-bold mb-0">Browse Tasks</h2>
                    <div class="d-flex align-items-center gap-3">
                        <span class="text-muted" id="task-count">Loading tasks...</span>
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                Sort by
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-sort="newest">Newest First</a></li>
                                <li><a class="dropdown-item" href="#" data-sort="oldest">Oldest First</a></li>
                                <li><a class="dropdown-item" href="#" data-sort="pay-high">Highest Pay</a></li>
                                <li><a class="dropdown-item" href="#" data-sort="pay-low">Lowest Pay</a></li>
                                <li><a class="dropdown-item" href="#" data-sort="deadline">Deadline</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="tasks-container">
                    <!-- Tasks will be populated by JavaScript -->
                </div>

                <div id="no-tasks-message" class="text-center py-5 d-none">
                    <i class="bi bi-search fs-1 text-muted mb-3"></i>
                    <h4 class="text-muted">No tasks found</h4>
                    <p class="text-muted">Try adjusting your filters or <a href="post.html">post a new task</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="../assets/scripts/data.js"></script>
    <script src="../assets/scripts/app.js"></script>
    
    <script>
        // Category filtering functionality
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        function applyCategoryFilter() {
            const category = getUrlParameter('category');
            const search = getUrlParameter('search');
            
            if (category) {
                // Show category filter display
                const categoryDisplay = document.getElementById('category-filter-display');
                const categoryText = document.getElementById('category-filter-text');
                
                const categoryNames = {
                    'academic': 'Academic Help',
                    'household': 'Household Tasks',
                    'tech': 'Tech Support',
                    'creative': 'Creative Services',
                    'delivery': 'Delivery & Errands',
                    'other': 'Other Services'
                };
                
                categoryText.textContent = `Showing tasks in category: ${categoryNames[category] || category}`;
                categoryDisplay.classList.remove('d-none');
                
                // Set the category filter in the form
                const categoryInput = document.createElement('input');
                categoryInput.type = 'hidden';
                categoryInput.name = 'category';
                categoryInput.value = category;
                categoryInput.id = 'category-filter-input';
                
                // Add to both forms
                document.getElementById('filter-form').appendChild(categoryInput.cloneNode(true));
                document.getElementById('filter-form-mobile').appendChild(categoryInput.cloneNode(true));
            }
            
            if (search) {
                // Set search input
                const searchInputs = document.querySelectorAll('#search-input, #search-input-mobile');
                searchInputs.forEach(input => {
                    input.value = search;
                });
            }
        }

        function clearCategoryFilter() {
            // Remove URL parameters and reload
            const url = new URL(window.location);
            url.searchParams.delete('category');
            url.searchParams.delete('search');
            window.location.href = url.toString();
        }

        // Initialize category filtering when page loads
        document.addEventListener('DOMContentLoaded', function() {
            applyCategoryFilter();
            
            // Initialize the browse page
            if (window.app) {
                window.app.initBrowsePage();
            }
        });
    </script>
</body>
</html>
