<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Browse Tasks - GetItDone</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/styles/styles.css">
</head>
<body>
    <!-- Fiverr-Style Header -->
    <header class="fiverr-header">
        <!-- Top Section -->
        <div class="header-top">
            <div class="container">
                <div class="header-content">
                    <!-- Logo -->
                    <div class="header-logo">
                        <a href="index.html" class="logo-link">
                            <i class="bi bi-check-circle-fill me-2"></i>
                            <span class="logo-text">GetItDone</span>
                        </a>
                    </div>
                    
                    <!-- Mobile Categories Menu Button -->
                    <div class="mobile-categories-btn">
                        <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileCategories" aria-controls="mobileCategories">
                            <i class="bi bi-list"></i>
                        </button>
                    </div>
                    
                    <!-- Search Bar -->
                    <div class="header-search">
                        <div class="search-container">
                            <input type="text" class="search-input" placeholder="What task are you looking for today?" id="header-search-input">
                            <button class="search-button" onclick="performSearch()">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                        <!-- Search Suggestions Dropdown -->
                        <div class="search-suggestions" id="search-suggestions">
                            <div class="suggestion-item" onclick="selectSuggestion('tutoring')">
                                <i class="bi bi-book"></i>
                                <span>Tutoring</span>
                            </div>
                            <div class="suggestion-item" onclick="selectSuggestion('cleaning')">
                                <i class="bi bi-house"></i>
                                <span>House Cleaning</span>
                            </div>
                            <div class="suggestion-item" onclick="selectSuggestion('delivery')">
                                <i class="bi bi-truck"></i>
                                <span>Delivery</span>
                            </div>
                            <div class="suggestion-item" onclick="selectSuggestion('tech help')">
                                <i class="bi bi-laptop"></i>
                                <span>Tech Help</span>
                            </div>
                            <div class="suggestion-item" onclick="selectSuggestion('creative')">
                                <i class="bi bi-palette"></i>
                                <span>Creative Services</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Right Actions -->
                    <div class="header-actions">
                        <!-- Not Logged In -->
                        <div id="guest-actions">
                            <a href="#" class="action-link" onclick="showLoginModal()">Login</a>
                            <a href="#" class="action-link" onclick="showRegisterModal()">Join</a>
                        </div>
                        
                        <!-- Logged In User -->
                        <div id="user-actions" style="display: none;">
                            <!-- Notifications -->
                            <div class="action-icon position-relative" onclick="showNotifications()">
                                <i class="bi bi-bell"></i>
                                <span class="notification-badge" id="header-notification-badge" style="display: none;">0</span>
                            </div>
                            
                            <!-- Messages -->
                            <div class="action-icon position-relative" onclick="openMessagesModal()">
                                <i class="bi bi-envelope"></i>
                                <span class="notification-badge" id="header-message-badge" style="display: none;">0</span>
                            </div>
                            
                            <!-- Orders/Tasks -->
                            <a href="my-stuff.html" class="action-link">My Tasks</a>
                            <a href="my-stuff.html" class="action-icon mobile-only" title="My Tasks">
                                <i class="bi bi-briefcase"></i>
                            </a>
                            
                            <!-- User Profile -->
                            <div class="user-profile" id="header-user-profile">
                                <div class="profile-avatar-header" onclick="toggleProfileDropdown()">
                                    <span class="profile-initial" id="profile-initial">U</span>
                                    <div class="online-indicator"></div>
                                </div>
                                
                                <!-- Profile Dropdown -->
                                <div class="profile-dropdown" id="profile-dropdown">
                                    <div class="dropdown-header">
                                        <div class="dropdown-user-info">
                                            <div class="dropdown-avatar">
                                                <span class="dropdown-initial" id="dropdown-initial">U</span>
                                            </div>
                                            <div class="dropdown-details">
                                                <div class="dropdown-name" id="dropdown-name">User Name</div>
                                                <div class="dropdown-email" id="dropdown-email">user@email.com</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="dropdown-divider"></div>
                                    <a href="account.html" class="dropdown-item">
                                        <i class="bi bi-person-circle"></i>
                                        <span>My Profile</span>
                                    </a>
                                    <a href="my-stuff.html" class="dropdown-item">
                                        <i class="bi bi-briefcase"></i>
                                        <span>My Tasks</span>
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a href="rules.html" class="dropdown-item">
                                        <i class="bi bi-shield-check"></i>
                                        <span>Rules & Safety</span>
                                    </a>
                                    <a href="about.html" class="dropdown-item">
                                        <i class="bi bi-info-circle"></i>
                                        <span>About</span>
                                    </a>
                                    <div class="dropdown-divider"></div>
                                    <a href="#" class="dropdown-item" onclick="logout()">
                                        <i class="bi bi-box-arrow-right"></i>
                                        <span>Logout</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <div class="header-bottom">
            <div class="container">
                <div class="bottom-nav">
                    <a href="post.html" class="post-task-btn">
                        <i class="bi bi-plus-circle"></i>
                        <span>Post a Task</span>
                    </a>
                    
                    <div class="category-nav">
                        <div class="category-item">
                            <a href="browse.html?category=academic" class="category-link">Academic Help</a>
                            <div class="category-preview">
                                <div class="preview-header">
                                    <h6>Popular Academic Tasks</h6>
                                </div>
                                <div class="preview-content">
                                    <div class="preview-task">Math tutoring</div>
                                    <div class="preview-task">Essay writing</div>
                                    <div class="preview-task">Research help</div>
                                </div>
                            </div>
                        </div>
                        <div class="category-item">
                            <a href="browse.html?category=household" class="category-link">Household Tasks</a>
                            <div class="category-preview">
                                <div class="preview-header">
                                    <h6>Popular Household Tasks</h6>
                                </div>
                                <div class="preview-content">
                                    <div class="preview-task">House cleaning</div>
                                    <div class="preview-task">Laundry</div>
                                    <div class="preview-task">Organizing</div>
                                </div>
                            </div>
                        </div>
                        <div class="category-item">
                            <a href="browse.html?category=tech" class="category-link">Tech Support</a>
                            <div class="category-preview">
                                <div class="preview-header">
                                    <h6>Popular Tech Tasks</h6>
                                </div>
                                <div class="preview-content">
                                    <div class="preview-task">Computer setup</div>
                                    <div class="preview-task">Software help</div>
                                    <div class="preview-task">Website building</div>
                                </div>
                            </div>
                        </div>
                        <div class="category-item">
                            <a href="browse.html?category=creative" class="category-link">Creative Services</a>
                            <div class="category-preview">
                                <div class="preview-header">
                                    <h6>Popular Creative Tasks</h6>
                                </div>
                                <div class="preview-content">
                                    <div class="preview-task">Graphic design</div>
                                    <div class="preview-task">Photo editing</div>
                                    <div class="preview-task">Video creation</div>
                                </div>
                            </div>
                        </div>
                        <div class="category-item">
                            <a href="browse.html?category=delivery" class="category-link">Delivery & Errands</a>
                            <div class="category-preview">
                                <div class="preview-header">
                                    <h6>Popular Delivery Tasks</h6>
                                </div>
                                <div class="preview-content">
                                    <div class="preview-task">Package pickup</div>
                                    <div class="preview-task">Grocery shopping</div>
                                    <div class="preview-task">Meal delivery</div>
                                </div>
                            </div>
                        </div>
                        <div class="category-item">
                            <a href="browse.html?category=other" class="category-link">Other Services</a>
                            <div class="category-preview">
                                <div class="preview-header">
                                    <h6>Popular Other Tasks</h6>
                                </div>
                                <div class="preview-content">
                                    <div class="preview-task">Pet sitting</div>
                                    <div class="preview-task">Event planning</div>
                                    <div class="preview-task">Consulting</div>
                                </div>
                            </div>
                        </div>
                        <a href="browse.html" class="category-link more">
                            <span>More</span>
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Categories Offcanvas -->
    <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileCategories" aria-labelledby="mobileCategoriesLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="mobileCategoriesLabel">Browse Categories</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="d-grid gap-2">
                <a href="post.html" class="btn btn-outline-primary">
                    <i class="bi bi-plus-circle me-2"></i>Post a Task
                </a>
                <hr>
                <a href="browse.html?category=academic" class="btn btn-outline-secondary text-start">
                    Academic Help
                </a>
                <a href="browse.html?category=household" class="btn btn-outline-secondary text-start">
                    Household Tasks
                </a>
                <a href="browse.html?category=tech" class="btn btn-outline-secondary text-start">
                    Tech Support
                </a>
                <a href="browse.html?category=creative" class="btn btn-outline-secondary text-start">
                    Creative Services
                </a>
                <a href="browse.html?category=delivery" class="btn btn-outline-secondary text-start">
                    Delivery & Errands
                </a>
                <a href="browse.html?category=other" class="btn btn-outline-secondary text-start">
                    Other Services
                </a>
                <a href="browse.html" class="btn btn-outline-secondary text-start">
                    View All Tasks
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container py-4">
        <!-- Category Filter Display -->
        <div class="row mb-4">
            <div class="col-12">
                <div id="category-filter-display" class="alert alert-info d-none">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-funnel me-2"></i>
                            <span id="category-filter-text">Showing tasks in category</span>
                        </div>
                        <button type="button" class="btn-close" onclick="clearCategoryFilter()"></button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Filters Sidebar -->
            <div class="col-lg-3 mb-4">
                <div class="filter-panel">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="fw-bold mb-0">Filters</h5>
                        <button class="btn btn-outline-primary btn-sm d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#filtersOffcanvas">
                            <i class="bi bi-funnel"></i>
                        </button>
                    </div>

                    <!-- Mobile Offcanvas -->
                    <div class="offcanvas offcanvas-start d-lg-none" tabindex="-1" id="filtersOffcanvas">
                        <div class="offcanvas-header">
                            <h5 class="offcanvas-title">Filters</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
                        </div>
                        <div class="offcanvas-body">
                            <form id="filter-form-mobile">
                                <!-- Search -->
                                <div class="filter-section">
                                    <label for="search-input-mobile" class="filter-title">Search</label>
                                    <input type="text" class="form-control" id="search-input-mobile" placeholder="Search tasks...">
                                </div>

                                <!-- Tags -->
                                <div class="filter-section">
                                    <label class="filter-title">Tags</label>
                                    <div class="tag-filters" id="tag-filters-mobile">
                                        <!-- Tags will be populated by JavaScript -->
                                    </div>
                                </div>

                                <!-- Status -->
                                <div class="filter-section">
                                    <label class="filter-title">Status</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="open" id="status-open-mobile" name="status" checked>
                                        <label class="form-check-label" for="status-open-mobile">
                                            Open Tasks
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="assigned" id="status-assigned-mobile" name="status" checked>
                                        <label class="form-check-label" for="status-assigned-mobile">
                                            Assigned Tasks
                                        </label>
                                    </div>
                                </div>




                                <!-- Pay Range -->
                                <div class="filter-section">
                                    <label class="filter-title">Pay Range</label>
                                    <div class="row">
                                        <div class="col-6">
                                            <input type="number" class="form-control" id="min-pay-mobile" placeholder="Min $" min="0">
                                        </div>
                                        <div class="col-6">
                                            <input type="number" class="form-control" id="max-pay-mobile" placeholder="Max $" min="0">
                                        </div>
                                    </div>
                                </div>

                                <!-- Deadline -->


                                <div class="d-grid gap-2 mt-4">
                                    <button type="submit" class="btn btn-primary">Apply Filters</button>
                                    <button type="button" class="btn btn-outline-secondary" onclick="clearFilters('mobile')">Clear All</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Desktop Filters -->
                    <form id="filter-form">
                        <!-- Search -->
                        <div class="filter-section">
                            <label for="search-input" class="filter-title">Search</label>
                            <div class="position-relative">
                                <input type="text" class="form-control" id="search-input" placeholder="Search tasks...">
                                <button type="button" class="btn btn-link position-absolute end-0 top-50 translate-middle-y me-2" id="search-clear" style="display: none;">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Tags -->
                        <div class="filter-section">
                            <label class="filter-title">Tags</label>
                            <div class="tag-filters" id="tag-filters">
                                <!-- Tags will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Status -->
                        <div class="filter-section">
                            <label class="filter-title">Status</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="open" id="status-open" name="status" checked>
                                <label class="form-check-label" for="status-open">
                                    Open Tasks
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="assigned" id="status-assigned" name="status" checked>
                                <label class="form-check-label" for="status-assigned">
                                    Assigned Tasks
                                </label>
                            </div>
                        </div>


                        <!-- University -->
                        <div class="filter-section">
                            <label class="filter-title">University</label>
                            <select class="form-select" id="university-filter">
                                <option value="">All Universities</option>
                                <option value="University of Alabama">University of Alabama</option>
                                <option value="Auburn University">Auburn University</option>
                                <option value="University of Alabama at Birmingham">University of Alabama at Birmingham</option>
                                <option value="University of Alabama in Huntsville">University of Alabama in Huntsville</option>
                                <option value="Troy University">Troy University</option>
                                <option value="Jacksonville State University">Jacksonville State University</option>
                                <option value="University of Montevallo">University of Montevallo</option>
                                <option value="Samford University">Samford University</option>
                                <option value="Birmingham-Southern College">Birmingham-Southern College</option>
                                <option value="Huntingdon College">Huntingdon College</option>
                                <option value="Spring Hill College">Spring Hill College</option>
                                <option value="University of West Alabama">University of West Alabama</option>
                                <option value="Alabama State University">Alabama State University</option>
                                <option value="Alabama A&M University">Alabama A&M University</option>
                                <option value="University of North Alabama">University of North Alabama</option>
                                <option value="Faulkner University">Faulkner University</option>
                                <option value="Miles College">Miles College</option>
                                <option value="Stillman College">Stillman College</option>
                                <option value="Tuskegee University">Tuskegee University</option>
                                <option value="Talladega College">Talladega College</option>
                                <option value="Concordia College Alabama">Concordia College Alabama</option>
                                <option value="Judson College">Judson College</option>
                                <option value="Athens State University">Athens State University</option>
                                <option value="Vanderbilt University">Vanderbilt University</option>
                                <option value="University of Tennessee">University of Tennessee</option>
                                <option value="University of Memphis">University of Memphis</option>
                                <option value="East Tennessee State University">East Tennessee State University</option>
                                <option value="Middle Tennessee State University">Middle Tennessee State University</option>
                                <option value="Austin Peay State University">Austin Peay State University</option>
                                <option value="Tennessee Technological University">Tennessee Technological University</option>
                                <option value="University of Tennessee at Martin">University of Tennessee at Martin</option>
                                <option value="University of Tennessee at Chattanooga">University of Tennessee at Chattanooga</option>
                                <option value="Belmont University">Belmont University</option>
                                <option value="Lipscomb University">Lipscomb University</option>
                                <option value="Trevecca Nazarene University">Trevecca Nazarene University</option>
                                <option value="Cumberland University">Cumberland University</option>
                                <option value="Union University">Union University</option>
                                <option value="Rhodes College">Rhodes College</option>
                                <option value="Sewanee: The University of the South">Sewanee: The University of the South</option>
                                <option value="Fisk University">Fisk University</option>
                                <option value="Tennessee State University">Tennessee State University</option>
                                <option value="Christian Brothers University">Christian Brothers University</option>
                                <option value="Southwestern College">Southwestern College</option>
                                <option value="Milligan University">Milligan University</option>
                                <option value="King University">King University</option>
                                <option value="Tusculum University">Tusculum University</option>
                                <option value="Carson-Newman University">Carson-Newman University</option>
                                <option value="Lee University">Lee University</option>
                                <option value="Bryan College">Bryan College</option>
                                <option value="Southern Adventist University">Southern Adventist University</option>
                                <option value="Tennessee Wesleyan University">Tennessee Wesleyan University</option>
                                <option value="Bethel University">Bethel University</option>
                                <option value="Freed-Hardeman University">Freed-Hardeman University</option>
                            </select>
                        </div>


                        <!-- Pay Range -->
                        <div class="filter-section">
                            <label class="filter-title">Pay Range</label>
                            <div class="row">
                                <div class="col-6">
                                    <input type="number" class="form-control" id="min-pay" placeholder="Min $" min="0">
                                </div>
                                <div class="col-6">
                                    <input type="number" class="form-control" id="max-pay" placeholder="Max $" min="0">
                                </div>
                            </div>
                        </div>

                        <!-- Deadline -->


                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary">Apply Filters</button>
                            <button type="button" class="btn btn-outline-secondary" onclick="clearFilters()">Clear All</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Tasks List -->
            <div class="col-lg-9">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="fw-bold mb-0">Browse Tasks</h2>
                    <div class="d-flex align-items-center gap-3">
                        <span class="text-white" id="task-count">Loading tasks...</span>
                        <div class="dropdown">
                            <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                Sort by
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" data-sort="newest">Newest First</a></li>
                                <li><a class="dropdown-item" href="#" data-sort="oldest">Oldest First</a></li>
                                <li><a class="dropdown-item" href="#" data-sort="pay-high">Highest Pay</a></li>
                                <li><a class="dropdown-item" href="#" data-sort="pay-low">Lowest Pay</a></li>
                                <li><a class="dropdown-item" href="#" data-sort="deadline">Deadline</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="row" id="tasks-container">
                    <!-- Tasks will be populated by JavaScript -->
                </div>

                <div id="no-tasks-message" class="text-center py-5 d-none">
                    <i class="bi bi-search fs-1 text-white mb-3"></i>
                    <h4 class="text-white">No tasks found</h4>
                    <p class="text-white">Try adjusting your filters or <a href="post.html">post a new task</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Modal -->
    <div class="modal fade" id="notifications-modal" tabindex="-1" aria-labelledby="notificationsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="notificationsModalLabel">Notifications</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="notifications-modal-list">
                        <div class="text-center text-white py-3">No notifications</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" onclick="markAllNotificationsRead()">Mark all as read</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal fade" id="profile-modal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="profileModalLabel">User Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="profile-modal-content">
                        <!-- Profile content will be populated by JavaScript -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="startConversationFromProfile()">Message</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Messages Modal -->
    <div class="modal fade" id="messages-modal" tabindex="-1" aria-labelledby="messagesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="messagesModalLabel">Messages</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="list-group" id="conversations-list-modal">
                                <div class="text-center text-white py-3">No conversations</div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div id="messages-content" style="display: none;">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 id="conversation-title">Select a conversation</h6>
                                </div>
                                <div class="messages-container border rounded p-3 mb-3" style="height: 300px; overflow-y: auto;" id="messages-container-modal">
                                    <div class="text-center text-white">Select a conversation to view messages</div>
                                </div>
                                <form id="message-form-modal">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Type your message..." id="message-input-modal">
                                        <button class="btn btn-primary" type="submit">Send</button>
                                    </div>
                                </form>
                            </div>
                            <div id="no-conversation-selected" class="text-center text-white py-5">
                                <i class="bi bi-chat-dots fs-1"></i>
                                <p>Select a conversation to start messaging</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="../assets/scripts/data.js"></script>
    <script src="../assets/scripts/app.js"></script>
    
    <script>
        // Category filtering functionality
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        function applyCategoryFilter() {
            const category = getUrlParameter('category');
            const search = getUrlParameter('search');
            
            if (category) {
                // Show category filter display
                const categoryDisplay = document.getElementById('category-filter-display');
                const categoryText = document.getElementById('category-filter-text');
                
                const categoryNames = {
                    'academic': 'Academic Help',
                    'household': 'Household Tasks',
                    'tech': 'Tech Support',
                    'creative': 'Creative Services',
                    'delivery': 'Delivery & Errands',
                    'other': 'Other Services'
                };
                
                categoryText.textContent = `Showing tasks in category: ${categoryNames[category] || category}`;
                categoryDisplay.classList.remove('d-none');
                
                // Set the category filter in the form
                const categoryInput = document.createElement('input');
                categoryInput.type = 'hidden';
                categoryInput.name = 'category';
                categoryInput.value = category;
                categoryInput.id = 'category-filter-input';
                
                // Add to both forms
                document.getElementById('filter-form').appendChild(categoryInput.cloneNode(true));
                document.getElementById('filter-form-mobile').appendChild(categoryInput.cloneNode(true));
            }
            
            if (search) {
                // Set search input
                const searchInputs = document.querySelectorAll('#search-input, #search-input-mobile');
                searchInputs.forEach(input => {
                    input.value = search;
                });
            }
        }

        function clearCategoryFilter() {
            // Remove URL parameters and reload
            const url = new URL(window.location);
            url.searchParams.delete('category');
            url.searchParams.delete('search');
            window.location.href = url.toString();
        }

        // University filtering
        function applyUniversityFilter() {
            const universityFilter = document.getElementById('university-filter');
            if (universityFilter) {
                universityFilter.addEventListener('change', function() {
                    if (window.app) {
                        window.app.filterTasksByUniversity(this.value);
                    }
                });
            }
        }

        // Initialize category filtering when page loads
        document.addEventListener('DOMContentLoaded', function() {
            applyCategoryFilter();
            applyUniversityFilter();
            
            // Initialize the browse page
            if (window.app) {
                window.app.initBrowsePage();
            }
        });
    </script>
</body>
</html>
